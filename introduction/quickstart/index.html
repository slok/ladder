<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Quickstart - Ladder docs</title>
    <meta name="generator" content="Hugo 0.17" />

    
    <meta name="description" content="A flexible and reliable autoscaler">
    
    <link rel="canonical" href="https://themotion.github.io/ladder/introduction/quickstart/">
    
    <meta name="author" content="TheMotion">
    

    <meta property="og:url" content="https://themotion.github.io/ladder/introduction/quickstart/">
    <meta property="og:title" content="Ladder docs">
    <meta property="og:image" content="https://themotion.github.io/ladder/img/logo.png">
    <meta name="apple-mobile-web-app-title" content="Ladder docs">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://themotion.github.io/ladder/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://themotion.github.io/ladder/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://themotion.github.io/ladder/fonts/icon.eot?52m981');
        src: url('https://themotion.github.io/ladder/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('https://themotion.github.io/ladder/fonts/icon.woff?52m981')
               format('woff'),
             url('https://themotion.github.io/ladder/fonts/icon.ttf?52m981')
               format('truetype'),
             url('https://themotion.github.io/ladder/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://themotion.github.io/ladder/stylesheets/application.css">
    <link rel="stylesheet" href="https://themotion.github.io/ladder/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://themotion.github.io/ladder/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://themotion.github.io/ladder/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto&#43;Mono">
    <style>
      body, input {
        font-family: 'Roboto', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://themotion.github.io/ladder/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-deep-purple palette-accent-light-blue">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Quickstart
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/themotionvideo" title="@themotionvideo on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/themotion" title="@themotion on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/themotion/ladder" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://themotion.github.io/ladder/img/logo.png">
        </div>
      
      <div class="name">
        <strong>Ladder docs <span class="version">0.1.0</span></strong>
        
          <br>
          themotion/ladder
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/themotion/ladder/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/themotion/ladder/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    <span class="section">Introduction</span>
    <ul>
      
        
        



<a  title="Overview" href="https://themotion.github.io/ladder/introduction/overview/">
	
	Overview
</a>



      
        
        



<a  title="Installing" href="https://themotion.github.io/ladder/introduction/installing/">
	
	Installing
</a>



      
        
        



<a  title="Quickstart" href="https://themotion.github.io/ladder/introduction/quickstart/">
	
	Quickstart
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Concepts</span>
    <ul>
      
        
        



<a  title="Autoscaler" href="https://themotion.github.io/ladder/concepts/autoscaler/">
	
	Autoscaler
</a>



      
        
        



<a  title="Blocks" href="https://themotion.github.io/ladder/concepts/blocks/">
	
	Blocks
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Available Blocks</span>
    <ul>
      
        
        



<a  title="Gatherers" href="https://themotion.github.io/ladder/blocks/gatherers/">
	
	Gatherers
</a>



      
        
        



<a  title="Arrangers" href="https://themotion.github.io/ladder/blocks/arrangers/">
	
	Arrangers
</a>



      
        
        



<a  title="Solvers" href="https://themotion.github.io/ladder/blocks/solvers/">
	
	Solvers
</a>



      
        
        



<a  title="Filters" href="https://themotion.github.io/ladder/blocks/filters/">
	
	Filters
</a>



      
        
        



<a  title="Scalers" href="https://themotion.github.io/ladder/blocks/scalers/">
	
	Scalers
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Operating</span>
    <ul>
      
        
        



<a  title="Running" href="https://themotion.github.io/ladder/operating/running/">
	
	Running
</a>



      
        
        



<a  title="Configuration" href="https://themotion.github.io/ladder/operating/configuration/">
	
	Configuration
</a>



      
        
        



<a  title="Metrics" href="https://themotion.github.io/ladder/operating/metrics/">
	
	Metrics
</a>



      
        
        



<a  title="API" href="https://themotion.github.io/ladder/operating/api/">
	
	API
</a>



      
        
        



<a  title="Using as a framework" href="https://themotion.github.io/ladder/operating/framework/">
	
	Using as a framework
</a>



      
    </ul>
  
</li>



<li>
  
    



<a  title="License" href="https://github.com/themotion/ladder/blob/master/LICENSE">
	
	License
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/themotionvideo" target="_blank" title="@themotionvideo on Twitter">
              @themotionvideo on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/themotion" target="_blank" title="@themotion on GitHub">
              @themotion on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:tech-honey-badger@themotion.com" title="Email of tech-honey-badger@themotion.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Quickstart </h1>

			

<p>Start making autoscalers in Ladder is very easy and fast, but if you haven&rsquo;t crafted any before
you may feel that you don&rsquo;t know where to start, this small tutorials will guide you so you understard
where to start and make your first autoscalers.</p>

<p>All the tutorials will use the <a href="https://hub.docker.com/r/themotion/ladder/tags/">official Docker image</a></p>

<h2 id="basic-tutorial">Basic tutorial</h2>

<p>For a basic tutorial we will keep it simple, a small autoscaler that will set machines on a <a href="http://docs.aws.amazon.com/autoscaling/latest/userguide/AutoScalingGroup.html">AWS ASG</a>
based on the number of messages on a <a href="https://aws.amazon.com/sqs/">AWS SQS</a> and aplying a constant factor.</p>

<h3 id="global-configuration-file">Global configuration file</h3>

<p>The first thing is to create <code>ladder.yml</code> file, this file has Ladder&rsquo;s global configuration:</p>

<pre><code class="language-yaml">global:
  warmup: 30s

autoscaler_files:
  - &quot;/etc/ladder/cfg-autoscalers/tutorial1/*.yml&quot;
</code></pre>

<p>We are using default settings except the warmup, warmup setting will make that any of the autoscaler doesn&rsquo;t do anything until that duration has passed.</p>

<p>Also we point to the autoscaler configuration, in this case all the files that are on <code>tutorial1</code>.</p>

<h3 id="autoscaler-configuration-file">Autoscaler configuration file</h3>

<p>Now we will create our autoscaler file, note that you may have multiple autoscaler files, and also
multiple autoscalers per file, but for this example we&rsquo;ll do it simple and use a single file and one
autoscaler.</p>

<p>We will start creating the file block by block.</p>

<h3 id="autoscaler-global-settings">Autoscaler global settings</h3>

<pre><code class="language-yaml">name: basic_tutorial_autoscaler_sqs_asg
description: &gt;
    basic tutorial autoscaler will set an AWS autoscaling group quantity based on the number of
    messages that an AWS SQS queue has at a given point aplying a constant factor
interval: 2m
scaling_wait_timeout: 3m
</code></pre>

<p>Our autoscaler is called <code>basic_tutorial_autoscaler_sqs_asg</code> and will run every <code>2m</code> to check if it needs to upscale or downscale, as a security measure we apply a <code>3m</code> timeout to the waiting time of the scaler when it decides to scale (an scaler waits until the scalation that has been applied has completed).</p>

<h3 id="autoscaler-input-settings">Autoscaler input settings</h3>

<p>In this case our autoscaler will have only one inputter to keep it simple. The inputter will return
the number of machines that wants based on an input, in our case the number of messages in a queue</p>

<pre><code class="language-yaml">inputters:
  - name: sqs_queue_basic_tutorial_job_number
    description: &quot;Get quantity based on the messages on the queue aplying a constant factor&quot;
    gather:
      kind: aws_sqs
      config:
        queue_url: &quot;https://sqs.eu-west-1.amazonaws.com/xxxxxxxxxxx/basic-tutorial-queue&quot;
        queue_property: &quot;ApproximateNumberOfMessages&quot;
        aws_region: &quot;eu-west-1&quot;
    arrange:
      kind: constant_factor
      config:
        factor: 20
        round_type: &quot;ceil&quot;
</code></pre>

<p>This inputter has 2 subblocks, a <a href="https://themotion.github.io/ladder/blocks/gatherers/">gantherer</a> the one that gets the number of messages from the queue, and
an <a href="https://themotion.github.io/ladder/blocks/arrangers/">arranger</a> the one that applies the logic to convert the number on messages quantity to number of machines
desired quantity.</p>

<p>In this case we will get the number of messages from the queue (in AWS SQS is known as <code>ApproximateNumberOfMessages</code>) and will apply to this number a constant factor of 20(simple division)
always rounding up. For example:</p>

<table>
<thead>
<tr>
<th>messages</th>
<th>machines</th>
</tr>
</thead>

<tbody>
<tr>
<td>20</td>
<td>2</td>
</tr>

<tr>
<td>50</td>
<td>3</td>
</tr>

<tr>
<td>100</td>
<td>5</td>
</tr>

<tr>
<td>5500</td>
<td>275</td>
</tr>

<tr>
<td>54321</td>
<td>2717</td>
</tr>

<tr>
<td>100000</td>
<td>5000</td>
</tr>
</tbody>
</table>

<h3 id="autoscaler-solver-settings">Autoscaler solver settings</h3>

<p>In this case as we only have on inputter the <a href="https://themotion.github.io/ladder/blocks/solvers/">solver</a> block is not neccessary because we don&rsquo;t have
the need to decide wich of the inputters will be the chosen one.</p>

<h4 id="autoscaler-filters-settings">Autoscaler filters settings</h4>

<p>We will apply 2 <a href="https://themotion.github.io/ladder/blocks/filters/">filters</a> as a filter chain. They will take the result returned by the inputter and apply
the filters as a pipeline, first filter output will be the input of the next one and so on.</p>

<pre><code class="language-yaml">filters:
    - kind: scaling_kind_interval
      config:
        scale_up_duration: 2m
        scale_down_duration: 10m

    - kind: limit
      config:
        max: 1000
        min: 2
</code></pre>

<p>Filters will be applied in the same order as defined in the configuration file, in this case first will
be applied the <code>scaling_kind_interval</code> filter and then <code>limit</code>.</p>

<p>We set <code>scaling_kind_interval</code>so we don&rsquo;t have spikes of machines, this filter will wait a concrete duration
before letting us to scale up or down, in this case we will wait at least for <code>2m</code> before scaling up (this can
be multiple iterations  of the autoscaler without doing nothing until it satisfies <code>2m</code> in scale up mode). On the
other hand we have <code>10m</code> to scale down, the same logic applies, it needs to be in scaling down mode for <code>10m</code> at least. As you can see we scale up fast, but scale down slowly, this is a common practice so we use the scaled up power
in case a new spike comes, and also we don&rsquo;t disturb our platform downscaling too fast.</p>

<p>The next filter is the safety filter that <strong>always</strong> should be set, is optional but you should set a limit.
In our case we want at least <code>2</code> machines running always, and tops we want <code>1000</code> (we don&rsquo;t want our company die due to an AWS invoice!)</p>

<h3 id="autoscaler-scaler-settings">Autoscaler scaler settings</h3>

<p>The <a href="https://themotion.github.io/ladder/blocks/scalers/">scaler</a> is the one that sets the quantity on the target, in our case an AWS ASG.</p>

<pre><code class="language-yaml">scale:
    kind: aws_autoscaling_group
    config:
      auto_scaling_group_name: &quot;basic-tutorial-AMIAutoScalingGroup&quot;
      aws_region: &quot;eu-west-1&quot;
      scale_up_wait_duration: 1m
      scale_down_wait_duration: 5s
</code></pre>

<p>Our scaler will set <code>basic-tutorial-AMIAutoScalingGroup</code> ASG as its target, it will wait <code>1m</code> after scaling up before continuing with the next iteration and will wait <code>5s</code> before downscaling, in other words, it waits
machines to spin up (not too much) and it doesn&rsquo;t wait after start downscaling.</p>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ASG scaler will do its best so only scales down the machines next to the <code>1h</code> of utilization (by default, it will wait every machine to be running for <code>50m</code> at least), this is because AWS charges you per hour. ASG autoscaler wants to save you money!</p>
</div>

<h3 id="putting-all-together">Putting all together</h3>

<p><code>ladder.yml</code></p>

<pre><code class="language-yaml">global:
  warmup: 30s

autoscaler_files:
  - &quot;/etc/ladder/cfg-autoscalers/tutorial1/*.yml&quot;
</code></pre>

<p><code>basic_tutorial.yaml</code></p>

<pre><code class="language-yaml">autoscalers:
- name: basic_tutorial_autoscaler_sqs_asg
  description: &gt;
    basic tutorial autoscaler will set an AWS autoscaling group quantity based on the number of
    messages that an AWS SQS queue has at a given point aplying a constant factor
  interval: 2m
  scaling_wait_timeout: 3m

  scale:
    kind: aws_autoscaling_group
    config:
      auto_scaling_group_name: &quot;basic-tutorial-AMIAutoScalingGroup&quot;
      aws_region: &quot;eu-west-1&quot;
      scale_up_wait_duration: 1m
      scale_down_wait_duration: 5s

  filters:
    - kind: scaling_kind_interval
      config:
        scale_up_duration: 2m
        scale_down_duration: 10m

    - kind: limit
      config:
        max: 1000
        min: 2

  inputters:
  - name: sqs_queue_basic_tutorial_job_number
    description: &quot;Get quantity based on the messages on the queue aplying a constant factor&quot;
    gather:
      kind: aws_sqs
      config:
        queue_url: &quot;https://sqs.eu-west-1.amazonaws.com/xxxxxxxxxxx/basic-tutorial-queue&quot;
        queue_property: &quot;ApproximateNumberOfMessages&quot;
        aws_region: &quot;eu-west-1&quot;
    arrange:
      kind: constant_factor
      config:
        factor: 20
        round_type: &quot;ceil&quot;
</code></pre>

<p>Now we need to run our autoscaler with AWS credentials:</p>

<pre><code class="language-bash">docker run  \
  --rm -it \
  -v `pwd`/ladder.yml:/etc/ladder/ladder.yml \
  -v `pwd`/basic_tutorial.yml:/etc/ladder/cfg-autoscalers/tutorial1/basic_tutorial.yml \
  -e AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} \
  -e AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} \
  -p 9094:9094 themotion/ladder
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use <code>-dry.run</code> flag to test it before autoscale nothing.</p>
</div>

<p>It will wait the warmup before start running the autoscaler, you can access to its endpoints on port <code>9094</code>, for example: <a href="http://127.0.0.1:9094/check">http://127.0.0.1:9094/check</a> and it will give you information:</p>

<pre><code class="language-json">{  
   &quot;status&quot;:&quot;Ok&quot;,
   &quot;uptime&quot;:&quot;1m45.514659061s&quot;,
   &quot;check_ts&quot;:&quot;2017-04-29 08:56:35.267076739 +0000 UTC&quot;,
   &quot;version&quot;:&quot;Ladder version 0.1.0, build master(695fa7b)&quot;,
   &quot;healthy&quot;:{  
      &quot;ladder_autoscaler&quot;:{  
         &quot;basic_tutorial_autoscaler_sqs_asg&quot;:&quot;running&quot;
      }
   },
   &quot;unhealthy&quot;:{  
      &quot;ladder_autoscaler&quot;:{  

      }
   }
}
</code></pre>

<p>And that&rsquo;s it! now your platform is autoscaled. Easy right?</p>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the BSD 3-clause &#39;New&#39; or &#39;Revised&#39; license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
  </div>

  <div class="next">
  
      <a href="https://themotion.github.io/ladder/operating/api/" title="API">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              API
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/themotion.github.io\/ladder\/';
      var repo_id  = 'themotion\/ladder';
    
    </script>

    <script src="https://themotion.github.io/ladder/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;
            
            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }
        

        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
